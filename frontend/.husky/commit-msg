#!/usr/bin/env sh

# Si no estamos en frontend, salir con √©xito
if [ ! -f "package.json" ]; then
  exit 0
fi

# Store the absolute path of the commit message file
COMMIT_MSG_FILE=$(realpath "$1")

# Run commitlint first
npx commitlint --edit "$COMMIT_MSG_FILE" || exit 1

# Get the commit message
COMMIT_MSG=$(cat "$COMMIT_MSG_FILE")

# Check if commit type is feat or fix
if echo "$COMMIT_MSG" | grep -qE "^(feat|fix):"; then
  echo "üí° Commit type is feat/fix ‚Üí Running tests..."
  npm test || {
    echo "‚ùå Tests failed. Commit aborted."
    exit 1
  }
  echo "‚úÖ Tests passed successfully!"
else
  echo "‚ÑπÔ∏è Commit type is not feat/fix ‚Üí Skipping tests."
fi